---
globs: api/**/*.py
description: 后端开发约束和规范
---

# 后端开发约束

## 🎯 后端开发原则

### 1. API设计约束
- **RESTful设计**: 遵循REST API设计规范
- **统一响应格式**: 所有API返回统一的响应格式
- **错误处理**: 完善的错误处理和状态码使用
- **参数验证**: 使用Pydantic进行请求参数验证
- **文档生成**: 使用FastAPI自动生成API文档

### 2. 数据库操作约束
- **查询优化**: 查询语句优化，避免N+1问题
- **事务处理**: 涉及多表操作必须使用事务
- **连接管理**: 合理管理数据库连接池
- **索引优化**: 为常用查询字段建立合适索引
- **数据安全**: 防止SQL注入，使用参数化查询

### 3. 异步任务约束
- **任务管理**: 使用统一的任务管理系统
- **状态跟踪**: 任务状态要实时更新和持久化
- **错误重试**: 失败任务要有重试机制
- **资源清理**: 任务完成后及时清理临时资源
- **进度反馈**: 长时间任务要提供进度反馈

### 4. 性能优化约束
- **缓存策略**: 合理使用缓存提升性能
- **内存管理**: 大数据量操作要考虑内存使用
- **并发控制**: 合理控制并发数量避免资源耗尽
- **日志记录**: 关键操作必须记录详细日志
- **监控告警**: 关键指标要有监控和告警

### 5. 安全约束
- **输入验证**: 所有用户输入必须验证和过滤
- **权限控制**: 实现细粒度的权限控制
- **数据加密**: 敏感数据要加密存储和传输
- **CORS配置**: 正确配置跨域资源共享
- **安全扫描**: 定期进行安全漏洞扫描

## 📁 关键文件参考
- 主应用: [api/main.py](mdc:api/main.py)
- 异步任务: [api/routers/async_tasks.py](mdc:api/routers/async_tasks.py)
- 查询接口: [api/routers/query.py](mdc:api/routers/query.py)
- 数据模型: [api/models/visual_query_models.py](mdc:api/models/visual_query_models.py)
- 核心引擎: [api/core/duckdb_engine.py](mdc:api/core/duckdb_engine.py)