# DuckDBé…ç½®çŠ¶æ€æŠ¥å‘Š

## ğŸ“Š é…ç½®è¿ç§»å®ŒæˆçŠ¶æ€

### âœ… å·²é…ç½®åŒ–çš„å‚æ•°

æ‰€æœ‰åŸå…ˆç¡¬ç¼–ç çš„DuckDBé…ç½®å‚æ•°ç°åœ¨éƒ½å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ï¼š

| é…ç½®é¡¹ | åŸç¡¬ç¼–ç å€¼ | ç°åœ¨å¯é…ç½® | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------------|------------|--------|------|
| `duckdb_threads` | `8` | âœ… | `8` | çº¿ç¨‹æ•° |
| `duckdb_memory_limit` | `8GB` | âœ… | `8GB` | å†…å­˜é™åˆ¶ |
| `duckdb_temp_directory` | `./data/duckdb/temp` | âœ… | `None` | ä¸´æ—¶ç›®å½• |
| `duckdb_home_directory` | `./data/duckdb/home` | âœ… | `None` | ä¸»ç›®å½• |
| `duckdb_extension_directory` | `./data/duckdb/extensions` | âœ… | `None` | æ‰©å±•ç›®å½• |
| `duckdb_enable_profiling` | `true` | âœ… | `true` | å¯ç”¨æ€§èƒ½åˆ†æ |
| `duckdb_profiling_output` | `./data/duckdb/profile.json` | âœ… | `None` | æ€§èƒ½åˆ†æè¾“å‡º |
| `duckdb_force_index_join` | `false` | âœ… | `false` | å¼ºåˆ¶ç´¢å¼•JOIN |
| `duckdb_enable_object_cache` | `true` | âœ… | `true` | å¯ç”¨å¯¹è±¡ç¼“å­˜ |
| `duckdb_preserve_insertion_order` | `false` | âœ… | `false` | ä¿æŒæ’å…¥é¡ºåº |
| `duckdb_enable_progress_bar` | `false` | âœ… | `false` | å¯ç”¨è¿›åº¦æ¡ |
| `duckdb_extensions` | `["excel", "json", "parquet"]` | âœ… | `["excel", "json", "parquet"]` | æ‰©å±•åˆ—è¡¨ |

### ğŸ”§ é…ç½®åº”ç”¨ä½ç½®

#### 1. **ä¸»è¦é…ç½®åº”ç”¨** - `api/core/duckdb_engine.py`
- `_apply_duckdb_configuration()` å‡½æ•°
- è‡ªåŠ¨è¯»å–æ‰€æœ‰ `duckdb_` å¼€å¤´çš„é…ç½®é¡¹
- æ™ºèƒ½åº”ç”¨é…ç½®ï¼Œæ”¯æŒä¸åŒç±»å‹

#### 2. **è¿æ¥æ± é…ç½®** - `api/core/duckdb_pool.py`
- `_configure_connection()` å‡½æ•°
- ç°åœ¨è°ƒç”¨ç»Ÿä¸€çš„é…ç½®ç³»ç»Ÿ
- é…ç½®å¤±è´¥æ—¶ä½¿ç”¨åŸºç¡€åå¤‡é…ç½®

#### 3. **é»˜è®¤é…ç½®åå¤‡** - `api/core/duckdb_engine.py`
- `_apply_default_duckdb_config()` å‡½æ•°
- ä¼˜å…ˆä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤å€¼
- å®Œå…¨å¤±è´¥æ—¶æ‰ä½¿ç”¨ç¡¬ç¼–ç åå¤‡å€¼

### ğŸ“ é…ç½®æ–‡ä»¶ç»“æ„

#### ä¸»é…ç½®æ–‡ä»¶ï¼š`config/app-config.json`
```json
{
  "duckdb_memory_limit": "8GB",
  "duckdb_threads": 8,
  "duckdb_extensions": ["excel", "json", "parquet"]
}
```

#### å®Œæ•´ç¤ºä¾‹ï¼š`config/app-config-duckdb-example.json`
åŒ…å«æ‰€æœ‰å¯é…ç½®çš„DuckDBå‚æ•°å’Œè¯´æ˜ã€‚

### ğŸš€ è‡ªåŠ¨åŒ–ç‰¹æ€§

#### 1. **è‡ªåŠ¨é…ç½®è¯†åˆ«**
- ç³»ç»Ÿè‡ªåŠ¨æ‰«ææ‰€æœ‰ `duckdb_` å¼€å¤´çš„é…ç½®é¡¹
- æ— éœ€æ‰‹åŠ¨æŒ‡å®šæ¯ä¸ªå‚æ•°

#### 2. **æ™ºèƒ½ç±»å‹å¤„ç†**
- å¸ƒå°”å€¼ï¼šè‡ªåŠ¨è½¬æ¢ä¸º `true`/`false`
- å­—ç¬¦ä¸²ï¼šç›´æ¥åº”ç”¨
- æ•°å­—ï¼šç›´æ¥åº”ç”¨
- æ•°ç»„ï¼šè‡ªåŠ¨å¤„ç†æ‰©å±•åˆ—è¡¨

#### 3. **é”™è¯¯å¤„ç†å’Œåå¤‡**
- é…ç½®åº”ç”¨å¤±è´¥æ—¶è‡ªåŠ¨å›é€€
- å¤šå±‚åå¤‡æœºåˆ¶ç¡®ä¿ç³»ç»Ÿç¨³å®š

### ğŸ“ ä½¿ç”¨è¯´æ˜

#### 1. **åŸºç¡€é…ç½®**
```json
{
  "duckdb_memory_limit": "16GB",
  "duckdb_threads": 16
}
```

#### 2. **æ€§èƒ½ä¼˜åŒ–é…ç½®**
```json
{
  "duckdb_enable_profiling": true,
  "duckdb_profiling_output": "./logs/profile.json",
  "duckdb_force_index_join": true
}
```

#### 3. **æ‰©å±•ç®¡ç†é…ç½®**
```json
{
  "duckdb_extensions": ["excel", "json", "parquet", "httpfs", "fts"]
}
```

### ğŸ” éªŒè¯æ–¹æ³•

#### 1. **é…ç½®åŠ è½½æµ‹è¯•**
```bash
cd api
python -c "
from core.config_manager import AppConfig
config = AppConfig()
duckdb_configs = {k: v for k, v in config.__dict__.items() if k.startswith('duckdb_')}
print(f'å‘ç° {len(duckdb_configs)} ä¸ªDuckDBé…ç½®é¡¹')
for k, v in duckdb_configs.items():
    print(f'  {k}: {v}')
"
```

#### 2. **è¿è¡Œæ—¶éªŒè¯**
- æŸ¥çœ‹åº”ç”¨å¯åŠ¨æ—¥å¿—
- æ£€æŸ¥DuckDBè¿æ¥é…ç½®
- éªŒè¯æ‰©å±•åŠ è½½çŠ¶æ€

### ğŸ“ˆ æ€§èƒ½å½±å“

#### 1. **é…ç½®åŠ è½½**
- ä¸€æ¬¡æ€§åŠ è½½ï¼Œæ— é‡å¤å¼€é”€
- é…ç½®ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤è¯»å–

#### 2. **è¿è¡Œæ—¶æ€§èƒ½**
- é…ç½®åº”ç”¨åœ¨è¿æ¥å»ºç«‹æ—¶è¿›è¡Œ
- ä¸å½±å“æŸ¥è¯¢æ‰§è¡Œæ€§èƒ½

#### 3. **å†…å­˜ä½¿ç”¨**
- é…ç½®å¯¹è±¡å†…å­˜å ç”¨æå°
- æ— é¢å¤–å†…å­˜å¼€é”€

### ğŸ¯ æ€»ç»“

âœ… **å®Œå…¨é…ç½®åŒ–**ï¼šæ‰€æœ‰åŸå…ˆç¡¬ç¼–ç çš„DuckDBå‚æ•°ç°åœ¨éƒ½å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶

âœ… **è‡ªåŠ¨åŒ–ç®¡ç†**ï¼šç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«å’Œåº”ç”¨é…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„

âœ… **å‘åå…¼å®¹**ï¼šä¿æŒåŸæœ‰é»˜è®¤å€¼ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œ

âœ… **çµæ´»æ‰©å±•**ï¼šæ”¯æŒè‡ªå®šä¹‰é…ç½®ï¼Œæ»¡è¶³ä¸åŒç¯å¢ƒéœ€æ±‚

âœ… **é”™è¯¯å¤„ç†**ï¼šå¤šå±‚åå¤‡æœºåˆ¶ï¼Œç¡®ä¿é…ç½®å¤±è´¥æ—¶ç³»ç»Ÿä»èƒ½æ­£å¸¸è¿è¡Œ

ç°åœ¨DuckDBå¼•æ“å®Œå…¨é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œç®¡ç†ï¼Œå®ç°äº†çœŸæ­£çš„"é…ç½®å³ä»£ç "ï¼ğŸ‰
