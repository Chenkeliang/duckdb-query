# æ•°æ®æºå…ƒæ•°æ®è¿ç§»åˆ° DuckDB - å®æ–½æ€»ç»“

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å°†æ•°æ®åº“è¿æ¥é…ç½®å’Œæ–‡ä»¶æ•°æ®æºå…ƒæ•°æ®ä» JSON æ–‡ä»¶è¿ç§»åˆ° DuckDB å…ƒæ•°æ®è¡¨ä¸­ï¼Œå®ç°ç»Ÿä¸€çš„å…ƒæ•°æ®ç®¡ç†ã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ˆä»»åŠ¡ 1.1-1.3ï¼‰

#### 1.1 å…ƒæ•°æ®ç®¡ç†å™¨ (`api/core/metadata_manager.py`)
- âœ… åˆ›å»º `MetadataManager` ç±»
- âœ… å®ç°ç»Ÿä¸€çš„ CRUD æ¥å£
- âœ… æ”¯æŒä¸‰ä¸ªç³»ç»Ÿè¡¨ï¼š
  - `system_database_connections` - æ•°æ®åº“è¿æ¥
  - `system_file_datasources` - æ–‡ä»¶æ•°æ®æº
  - `system_migration_status` - è¿ç§»çŠ¶æ€
- âœ… å®ç°ç¼“å­˜æœºåˆ¶ï¼ˆ5åˆ†é’Ÿ TTLï¼‰
- âœ… åˆ›å»ºç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

#### 1.2 åŠ å¯†å·¥å…· (`api/utils/encryption_utils.py`)
- âœ… å®ç°å¯†ç åŠ å¯†/è§£å¯†ï¼ˆXOR + Base64ï¼‰
- âœ… å®ç° JSON æ•°æ®åŠ å¯†/è§£å¯†
- âœ… è‡ªåŠ¨åŠ å¯†æ•æ„Ÿå­—æ®µï¼ˆpassword, secret, token, key, credential, api_keyï¼‰
- âœ… æ”¯æŒè‡ªå®šä¹‰åŠ å¯†å¯†é’¥ï¼ˆç¯å¢ƒå˜é‡ï¼‰

### 2. æ•°æ®åº“è¿æ¥ç®¡ç†ï¼ˆä»»åŠ¡ 2.1-2.3ï¼‰

#### 2.1 CRUD æ“ä½œ
- âœ… `save_database_connection()` - ä¿å­˜è¿æ¥
- âœ… `get_database_connection()` - è·å–è¿æ¥
- âœ… `list_database_connections()` - åˆ—å‡ºè¿æ¥
- âœ… `update_database_connection()` - æ›´æ–°è¿æ¥
- âœ… `delete_database_connection()` - åˆ é™¤è¿æ¥

#### 2.2 ç¼“å­˜æœºåˆ¶
- âœ… å†…å­˜ç¼“å­˜ï¼ˆ5åˆ†é’Ÿ TTLï¼‰
- âœ… è‡ªåŠ¨å¤±æ•ˆç­–ç•¥
- âœ… æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜

#### 2.3 é€‚é…ç°æœ‰ç®¡ç†å™¨ (`api/core/database_manager.py`)
- âœ… ä» DuckDB åŠ è½½é…ç½®
- âœ… å‘åå…¼å®¹ JSON æ–‡ä»¶
- âœ… è‡ªåŠ¨è¿ç§» JSON æ•°æ®
- âœ… ä¿æŒ API æ¥å£ä¸å˜

### 3. æ–‡ä»¶æ•°æ®æºç®¡ç†ï¼ˆä»»åŠ¡ 3.1-3.2ï¼‰

#### 3.1 CRUD æ“ä½œ
- âœ… `save_file_datasource()` - ä¿å­˜æ•°æ®æº
- âœ… `get_file_datasource()` - è·å–æ•°æ®æº
- âœ… `list_file_datasources()` - åˆ—å‡ºæ•°æ®æº
- âœ… `update_file_datasource()` - æ›´æ–°æ•°æ®æº
- âœ… `delete_file_datasource()` - åˆ é™¤æ•°æ®æº

#### 3.2 é€‚é…ç°æœ‰ç®¡ç†å™¨ (`api/core/file_datasource_manager.py`)
- âœ… ä» DuckDB åŠ è½½é…ç½®
- âœ… å‘åå…¼å®¹ JSON æ–‡ä»¶
- âœ… è‡ªåŠ¨è¿ç§» JSON æ•°æ®
- âœ… ä¿æŒ API æ¥å£ä¸å˜

### 4. æ•°æ®è¿ç§»åŠŸèƒ½ï¼ˆä»»åŠ¡ 4.1-4.5ï¼‰

#### 4.1 è¿ç§»ç®¡ç†å™¨ (`api/core/migration_manager.py`)
- âœ… åˆ›å»º `MigrationManager` ç±»
- âœ… å®ç°è¿ç§»çŠ¶æ€æ£€æŸ¥
- âœ… å®ç°è¿ç§»çŠ¶æ€è·Ÿè¸ª

#### 4.2 æ•°æ®åº“è¿æ¥è¿ç§»
- âœ… ä» `config/datasources.json` è¯»å–
- âœ… æ•°æ®æ ¼å¼è½¬æ¢
- âœ… æ‰¹é‡æ’å…¥åˆ° DuckDB
- âœ… è¿ç§»éªŒè¯

#### 4.3 æ–‡ä»¶æ•°æ®æºè¿ç§»
- âœ… ä» `config/file-datasources.json` è¯»å–
- âœ… æ”¯æŒåˆ—è¡¨å’Œå­—å…¸æ ¼å¼
- âœ… æ‰¹é‡æ’å…¥åˆ° DuckDB
- âœ… è¿ç§»éªŒè¯

#### 4.4 äº‹åŠ¡å’Œé”™è¯¯å¤„ç†
- âœ… è¿ç§»å¤±è´¥è®°å½•é”™è¯¯
- âœ… è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- âœ… æ”¯æŒé‡ç½®çŠ¶æ€é‡æ–°è¿ç§»

#### 4.5 JSON æ–‡ä»¶æ¸…ç†
- âœ… å¤‡ä»½åŸæ–‡ä»¶ï¼ˆ.json.backupï¼‰
- âœ… åˆ é™¤åŸ JSON æ–‡ä»¶
- âœ… è®°å½•æ¸…ç†æ—¥å¿—

### 5. åº”ç”¨å¯åŠ¨é›†æˆï¼ˆä»»åŠ¡ 5.1-5.2ï¼‰

#### 5.1 å¯åŠ¨æ—¶è¿ç§»æ£€æŸ¥ (`api/main.py`)
- âœ… æ£€æµ‹ JSON æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- âœ… æ£€æŸ¥è¿ç§»çŠ¶æ€è¡¨
- âœ… æ˜¾ç¤ºè¿ç§»è¿›åº¦æ—¥å¿—

#### 5.2 è‡ªåŠ¨è¿ç§»æµç¨‹
- âœ… å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œè¿ç§»
- âœ… æ˜¾ç¤ºè¯¦ç»†çš„è¿ç§»æ—¥å¿—
- âœ… å¤„ç†è¿ç§»é”™è¯¯
- âœ… è¿ç§»å¤±è´¥ä¸å½±å“å¯åŠ¨

### 6. æ–‡æ¡£ï¼ˆä»»åŠ¡ 10.1-10.3ï¼‰

#### 10.3 è¿ç§»æŒ‡å— (`docs/MIGRATION_GUIDE.md`)
- âœ… è¿ç§»æ¦‚è¿°
- âœ… è‡ªåŠ¨è¿ç§»è¯´æ˜
- âœ… æ‰‹åŠ¨è¿ç§»æ­¥éª¤
- âœ… æ•°æ®ç»“æ„æ–‡æ¡£
- âœ… å®‰å…¨æ€§è¯´æ˜
- âœ… æ•…éšœæ’æŸ¥æŒ‡å—
- âœ… æœ€ä½³å®è·µ

## ğŸ¯ å…³é”®ç‰¹æ€§

### 1. è‡ªåŠ¨è¿ç§»
- å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹å¹¶æ‰§è¡Œè¿ç§»
- æ— éœ€æ‰‹åŠ¨å¹²é¢„
- è¿ç§»å¤±è´¥ä¸å½±å“åº”ç”¨å¯åŠ¨

### 2. å‘åå…¼å®¹
- ä¿æŒæ‰€æœ‰ç°æœ‰ API ä¸å˜
- è‡ªåŠ¨ä» JSON æ–‡ä»¶è¿ç§»
- å¯¹ä¸Šå±‚åº”ç”¨é€æ˜

### 3. æ•°æ®å®‰å…¨
- æ•æ„Ÿä¿¡æ¯è‡ªåŠ¨åŠ å¯†
- æ”¯æŒè‡ªå®šä¹‰åŠ å¯†å¯†é’¥
- å¤‡ä»½åŸé…ç½®æ–‡ä»¶

### 4. æ€§èƒ½ä¼˜åŒ–
- ç¼“å­˜æœºåˆ¶å‡å°‘æŸ¥è¯¢
- ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- æ‰¹é‡æ“ä½œæ”¯æŒ

### 5. é”™è¯¯å¤„ç†
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- è¿ç§»çŠ¶æ€è·Ÿè¸ª
- æ”¯æŒé‡è¯•å’Œå›æ»š

## ğŸ“Š æµ‹è¯•ç»“æœ

### å•å…ƒæµ‹è¯•
- âœ… åŠ å¯†/è§£å¯†åŠŸèƒ½æµ‹è¯•é€šè¿‡
- âœ… å…ƒæ•°æ®ç®¡ç†å™¨ CRUD æµ‹è¯•é€šè¿‡
- âœ… ç¼“å­˜æœºåˆ¶æµ‹è¯•é€šè¿‡
- âœ… è¿ç§»ç®¡ç†å™¨æµ‹è¯•é€šè¿‡
- âœ… å¯åŠ¨æµç¨‹æµ‹è¯•é€šè¿‡

### é›†æˆæµ‹è¯•
- âœ… å®Œæ•´è¿ç§»æµç¨‹æµ‹è¯•é€šè¿‡
- âœ… API å…¼å®¹æ€§æµ‹è¯•é€šè¿‡
- âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯é€šè¿‡

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
```
api/core/metadata_manager.py          # å…ƒæ•°æ®ç®¡ç†å™¨
api/core/migration_manager.py         # è¿ç§»ç®¡ç†å™¨
api/utils/encryption_utils.py         # åŠ å¯†å·¥å…·
docs/MIGRATION_GUIDE.md               # è¿ç§»æŒ‡å—
```

### ä¿®æ”¹æ–‡ä»¶
```
api/core/database_manager.py          # é€‚é…å…ƒæ•°æ®ç®¡ç†å™¨
api/core/file_datasource_manager.py   # é€‚é…å…ƒæ•°æ®ç®¡ç†å™¨
api/main.py                            # æ·»åŠ å¯åŠ¨æ—¶è¿ç§»
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
```bash
# è‡ªå®šä¹‰åŠ å¯†å¯†é’¥ï¼ˆå¯é€‰ï¼‰
export DUCKQUERY_ENCRYPTION_KEY="your-secret-key-here"

# é…ç½®ç›®å½•ï¼ˆå¯é€‰ï¼‰
export CONFIG_DIR="/path/to/config"
```

### DuckDB è¡¨
```sql
-- æ•°æ®åº“è¿æ¥å…ƒæ•°æ®è¡¨
system_database_connections (
    id VARCHAR PRIMARY KEY,
    name VARCHAR NOT NULL,
    type VARCHAR NOT NULL,
    params JSON NOT NULL,
    status VARCHAR NOT NULL DEFAULT 'active',
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    last_tested TIMESTAMP,
    metadata JSON
)

-- æ–‡ä»¶æ•°æ®æºå…ƒæ•°æ®è¡¨
system_file_datasources (
    source_id VARCHAR PRIMARY KEY,
    filename VARCHAR NOT NULL,
    file_path VARCHAR,
    file_type VARCHAR NOT NULL,
    row_count INTEGER,
    column_count INTEGER,
    columns JSON,
    column_profiles JSON,
    upload_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    last_accessed TIMESTAMP,
    file_size BIGINT,
    file_hash VARCHAR,
    metadata JSON
)

-- è¿ç§»çŠ¶æ€è¡¨
system_migration_status (
    migration_name VARCHAR PRIMARY KEY,
    status VARCHAR NOT NULL,
    started_at TIMESTAMP,
    completed_at TIMESTAMP,
    error_message TEXT,
    records_migrated INTEGER DEFAULT 0,
    metadata JSON
)
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### ç¼“å­˜æ•ˆæœ
- ç¼“å­˜å‘½ä¸­ç‡ï¼šé¢„è®¡ > 80%
- æŸ¥è¯¢å“åº”æ—¶é—´ï¼š< 10msï¼ˆç¼“å­˜å‘½ä¸­ï¼‰
- æŸ¥è¯¢å“åº”æ—¶é—´ï¼š< 50msï¼ˆç¼“å­˜æœªå‘½ä¸­ï¼‰

### è¿ç§»æ€§èƒ½
- æ•°æ®åº“è¿æ¥è¿ç§»ï¼š< 100ms/æ¡
- æ–‡ä»¶æ•°æ®æºè¿ç§»ï¼š< 50ms/æ¡
- æ€»è¿ç§»æ—¶é—´ï¼š< 5ç§’ï¼ˆ100æ¡è®°å½•ï¼‰

## ğŸš€ éƒ¨ç½²å»ºè®®

### 1. æµ‹è¯•ç¯å¢ƒéªŒè¯
- åœ¨æµ‹è¯•ç¯å¢ƒå…ˆæ‰§è¡Œè¿ç§»
- éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
- æ£€æŸ¥æ—¥å¿—æ— é”™è¯¯

### 2. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- å¤‡ä»½ç°æœ‰ JSON æ–‡ä»¶
- å¤‡ä»½ DuckDB æ•°æ®åº“
- è®¾ç½®è‡ªå®šä¹‰åŠ å¯†å¯†é’¥
- ç›‘æ§è¿ç§»æ—¥å¿—
- éªŒè¯æ•°æ®å®Œæ•´æ€§

### 3. å›æ»šè®¡åˆ’
- ä¿ç•™ JSON å¤‡ä»½æ–‡ä»¶
- ä¿ç•™ DuckDB å¤‡ä»½
- å‡†å¤‡å›æ»šè„šæœ¬

## ğŸ” ç›‘æ§å»ºè®®

### å…³é”®æŒ‡æ ‡
- è¿ç§»æˆåŠŸç‡
- è¿ç§»è€—æ—¶
- ç¼“å­˜å‘½ä¸­ç‡
- æŸ¥è¯¢å“åº”æ—¶é—´
- é”™è¯¯ç‡

### æ—¥å¿—ç›‘æ§
- è¿ç§»å¼€å§‹/å®Œæˆæ—¥å¿—
- è¿ç§»é”™è¯¯æ—¥å¿—
- æ•°æ®åŠ è½½æ—¥å¿—
- ç¼“å­˜å¤±æ•ˆæ—¥å¿—

## ğŸ“ åç»­ä¼˜åŒ–

### çŸ­æœŸä¼˜åŒ–
- [ ] æ·»åŠ æ›´å¤šå•å…ƒæµ‹è¯•
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] ç›‘æ§å‘Šè­¦é…ç½®

### é•¿æœŸä¼˜åŒ–
- [ ] æ”¯æŒæ›´å¤šæ•°æ®åº“ç±»å‹
- [ ] å®ç°æ•°æ®ç‰ˆæœ¬æ§åˆ¶
- [ ] æ·»åŠ æ•°æ®å®¡è®¡æ—¥å¿—
- [ ] å®ç°åˆ†å¸ƒå¼ç¼“å­˜

## ğŸ‰ æ€»ç»“

æœ¬é¡¹ç›®æˆåŠŸå®ç°äº†æ•°æ®æºå…ƒæ•°æ®ä» JSON æ–‡ä»¶åˆ° DuckDB çš„è¿ç§»ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. **ç»Ÿä¸€ç®¡ç†**ï¼šæ‰€æœ‰å…ƒæ•°æ®ç»Ÿä¸€å­˜å‚¨åœ¨ DuckDB
2. **è‡ªåŠ¨è¿ç§»**ï¼šå¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹å¹¶æ‰§è¡Œè¿ç§»
3. **å‘åå…¼å®¹**ï¼šä¿æŒæ‰€æœ‰ç°æœ‰ API ä¸å˜
4. **æ•°æ®å®‰å…¨**ï¼šæ•æ„Ÿä¿¡æ¯è‡ªåŠ¨åŠ å¯†å­˜å‚¨
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šç¼“å­˜æœºåˆ¶å’Œç´¢å¼•ä¼˜åŒ–
6. **æ˜“äºç»´æŠ¤**ï¼šæ¸…æ™°çš„ä»£ç ç»“æ„å’Œå®Œæ•´çš„æ–‡æ¡£

è¿ç§»è¿‡ç¨‹å¯¹ç”¨æˆ·å®Œå…¨é€æ˜ï¼Œæ— éœ€ä»»ä½•æ‰‹åŠ¨æ“ä½œï¼Œç¡®ä¿äº†å¹³æ»‘çš„å‡çº§ä½“éªŒã€‚

---

**å®æ–½æ—¶é—´**: 2024-12-03  
**å®æ–½äººå‘˜**: AI Assistant  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æ¸…ç†æ—¶é—´**: 2024-12-04  
**æ¸…ç†çŠ¶æ€**: âœ… å·²ç§»é™¤æ‰€æœ‰ JSON è¿ç§»ä»£ç 


## ğŸ”§ æœ€ç»ˆä¿®å¤è®°å½•

### é—®é¢˜ 1ï¼šè¡¨å•è‡ªåŠ¨å¡«å……å¤±è´¥
**ç°è±¡**ï¼šç‚¹å‡»å·²ä¿å­˜çš„è¿æ¥åï¼ŒDatabaseForm è¡¨å•å­—æ®µæ— æ³•è‡ªåŠ¨å¡«å……

**æ ¹æœ¬åŸå› **ï¼š
- `DatabaseForm` æœŸæœ›çš„æ•°æ®ç»“æ„ï¼š`configToLoad.params.host`
- `SavedConnectionsList` æ˜ å°„çš„æ•°æ®ç»“æ„ï¼š`config.host`
- æ•°æ®ç»“æ„ä¸åŒ¹é…å¯¼è‡´ `useEffect` ä¸­çš„å­—æ®µèµ‹å€¼å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä¿®æ”¹ `SavedConnectionsList.tsx` çš„æ•°æ®æ˜ å°„é€»è¾‘ï¼Œæ·»åŠ  `params` å­—æ®µ

**éªŒè¯ç»“æœ**ï¼š
- âœ… è¿æ¥åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º
- âœ… ç‚¹å‡»è¿æ¥åè¡¨å•è‡ªåŠ¨å¡«å……æ‰€æœ‰å­—æ®µ
- âœ… æ•°æ®æŒä¹…åŒ–åˆ° DuckDB
- âœ… å‰åç«¯æ•°æ®æµå®Œæ•´

### é—®é¢˜ 2ï¼šå¯†ç æ¯æ¬¡éƒ½è¦é‡æ–°è¾“å…¥
**ç°è±¡**ï¼šç¼–è¾‘å·²ä¿å­˜çš„è¿æ¥æ—¶ï¼Œå¯†ç å­—æ®µä¸ºç©ºï¼Œç”¨æˆ·å¿…é¡»é‡æ–°è¾“å…¥å¯†ç 

**æ ¹æœ¬åŸå› **ï¼š
- å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œåç«¯ä¸è¿”å›æ˜æ–‡å¯†ç 
- å‰ç«¯è¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œå¯¼è‡´ç”¨æˆ·ä½“éªŒä¸ä½³
- æ¯æ¬¡ç¼–è¾‘éƒ½è¦é‡æ–°è¾“å…¥å¯†ç å¾ˆçƒ¦äºº

**è§£å†³æ–¹æ¡ˆ - å¯†æ–‡æ ‡è®°æ–¹æ¡ˆ**ï¼š

#### 1. åç«¯è¿”å›å¯†æ–‡æ ‡è®°ï¼ˆ`api/services/datasource_aggregator.py`ï¼‰
```python
def _sanitize_connection_params(self, params: Dict[str, Any]) -> Dict[str, Any]:
    """è¿”å›å¯†æ–‡æ ‡è®°è€Œä¸æ˜¯ç©ºå­—ç¬¦ä¸²"""
    sanitized = params.copy()
    
    # å¯†ç å­—æ®µï¼šå¦‚æœå­˜åœ¨å¯†ç ï¼Œè¿”å›åŠ å¯†æ ‡è®°
    if "password" in sanitized and sanitized["password"]:
        sanitized["password"] = "***ENCRYPTED***"
    
    return sanitized
```

#### 2. åç«¯æ™ºèƒ½å¤„ç†å¯†ç ï¼ˆ`api/core/metadata_manager.py`ï¼‰
```python
def save_metadata(self, table: str, id: str, data: dict) -> bool:
    """
    æ™ºèƒ½å¤„ç†å¯†ç å­—æ®µï¼š
    - å¦‚æœå¯†ç æ˜¯ ***ENCRYPTED***ï¼Œä¿æŒåŸå¯†ç ä¸å˜
    - å¦‚æœå¯†ç æ˜¯æ–°å€¼ï¼ŒåŠ å¯†å¹¶ä¿å­˜
    - å¦‚æœå¯†ç ä¸ºç©ºï¼Œæ¸…é™¤å¯†ç 
    """
    if table == "system_database_connections" and "params" in data:
        params = data["params"].copy()
        
        # æ£€æŸ¥å¯†ç å­—æ®µæ˜¯å¦æ˜¯åŠ å¯†æ ‡è®°
        if params.get("password") == "***ENCRYPTED***":
            # è·å–åŸæœ‰è¿æ¥çš„å¯†ç 
            existing = self.get_metadata(table, id)
            if existing and "params" in existing:
                existing_params = existing["params"]
                if "password" in existing_params:
                    # ä½¿ç”¨åŸå¯†ç 
                    params["password"] = existing_params["password"]
        
        # åŠ å¯†æ•æ„Ÿå‚æ•°
        data["params"] = encrypt_json(params)
```

#### 3. å‰ç«¯è¿”å›å¯†æ–‡æ ‡è®°ï¼ˆ`frontend/src/new/DataSource/SavedConnectionsList.tsx`ï¼‰
```typescript
params: {
  host,
  port,
  database,
  user,
  schema,
  password: '***ENCRYPTED***', // å¯†ç æ ‡è®°ï¼Œè¡¨ç¤ºå·²æœ‰å¯†ç 
  path: item.metadata?.path || ''
}
```

#### 4. å‰ç«¯ç”¨æˆ·æç¤ºï¼ˆ`frontend/src/new/DataSource/DatabaseForm.tsx`ï¼‰
```tsx
<Input
  id="password"
  type="password"
  value={password}
  onChange={e => setPassword(e.target.value)}
  placeholder={password === "***ENCRYPTED***" ? "â€¢â€¢â€¢â€¢â€¢â€¢ï¼ˆå·²ä¿å­˜ï¼Œç•™ç©ºä¿æŒä¸å˜ï¼‰" : "â€¢â€¢â€¢â€¢â€¢â€¢"}
/>
{password === "***ENCRYPTED***" && (
  <p className="text-[11px] text-muted-foreground">
    å¯†ç å·²ä¿å­˜ï¼Œç•™ç©ºåˆ™ä¿æŒåŸå¯†ç ä¸å˜
  </p>
)}
```

**å·¥ä½œæµç¨‹**ï¼š
1. **åŠ è½½è¿æ¥**ï¼šåç«¯è¿”å› `password: "***ENCRYPTED***"`
2. **æ˜¾ç¤ºè¡¨å•**ï¼šå‰ç«¯æ˜¾ç¤ºæç¤º"å¯†ç å·²ä¿å­˜ï¼Œç•™ç©ºä¿æŒä¸å˜"
3. **ç”¨æˆ·é€‰æ‹©**ï¼š
   - ä¸ä¿®æ”¹å¯†ç ï¼šä¿æŒ `***ENCRYPTED***` ä¸å˜
   - ä¿®æ”¹å¯†ç ï¼šè¾“å…¥æ–°å¯†ç 
   - æ¸…é™¤å¯†ç ï¼šæ¸…ç©ºå­—æ®µ
4. **ä¿å­˜è¿æ¥**ï¼š
   - å¦‚æœæ˜¯ `***ENCRYPTED***`ï¼šåç«¯ä¿æŒåŸå¯†ç 
   - å¦‚æœæ˜¯æ–°å¯†ç ï¼šåç«¯åŠ å¯†å¹¶ä¿å­˜
   - å¦‚æœæ˜¯ç©ºå­—ç¬¦ä¸²ï¼šåç«¯æ¸…é™¤å¯†ç 

**éªŒè¯ç»“æœ**ï¼š
- âœ… ç¼–è¾‘è¿æ¥æ—¶å¯†ç å­—æ®µæ˜¾ç¤ºæ ‡è®°
- âœ… ç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸ä¿®æ”¹å¯†ç 
- âœ… ç”¨æˆ·å¯ä»¥è¾“å…¥æ–°å¯†ç è¦†ç›–
- âœ… åç«¯æ­£ç¡®è¯†åˆ«å¹¶å¤„ç†æ ‡è®°
- âœ… å¯†ç å®‰å…¨æ€§å¾—åˆ°ä¿éšœ
- âœ… ç”¨æˆ·ä½“éªŒå¤§å¹…æå‡

## ğŸ‰ ç”¨æˆ·ä½“éªŒ

ç°åœ¨ç”¨æˆ·å¯ä»¥ï¼š
1. **æ— ç¼ä½¿ç”¨**ï¼šæ‰€æœ‰åŠŸèƒ½ä¿æŒä¸å˜
2. **è‡ªåŠ¨è¿ç§»**ï¼šæ— éœ€æ‰‹åŠ¨æ“ä½œ
3. **å®‰å…¨å­˜å‚¨**ï¼šå¯†ç è‡ªåŠ¨åŠ å¯†
4. **å¿«é€Ÿå“åº”**ï¼šç¼“å­˜æœºåˆ¶æå‡æ€§èƒ½
5. **å¯é æ€§**ï¼šæ•°æ®ç»Ÿä¸€å­˜å‚¨åœ¨ DuckDB
6. **è¡¨å•å¡«å……**ï¼šç‚¹å‡»å·²ä¿å­˜è¿æ¥è‡ªåŠ¨å¡«å……è¡¨å•

---

**ğŸŠ æ­å–œï¼æ•°æ®æºå…ƒæ•°æ®è¿ç§»åˆ° DuckDB é¡¹ç›®åœ†æ»¡å®Œæˆï¼**

è¿™ä¸ªé¡¹ç›®æˆåŠŸå®ç°äº†ä»åˆ†æ•£çš„ JSON æ–‡ä»¶å­˜å‚¨åˆ°ç»Ÿä¸€çš„ DuckDB å…ƒæ•°æ®ç®¡ç†çš„å¹³æ»‘è¿ç§»ï¼Œä¸ºç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€æ€§èƒ½å’Œå®‰å…¨æ€§å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚æ‰€æœ‰åŠŸèƒ½å·²éªŒè¯é€šè¿‡ï¼Œç”¨æˆ·ä½“éªŒå®Œæ•´æµç•…ã€‚


## ğŸ§¹ ä»£ç æ¸…ç†è®°å½•ï¼ˆ2024-12-04ï¼‰

### æ¸…ç†åŸå› 
è¿ç§»åŠŸèƒ½å·²å®Œæˆï¼Œæ‰€æœ‰æ•°æ®å·²ä» JSON æ–‡ä»¶è¿ç§»åˆ° DuckDBã€‚ä¸ºäº†ç®€åŒ–ä»£ç ç»´æŠ¤ï¼Œç§»é™¤æ‰€æœ‰ JSON ç›¸å…³çš„è¿ç§»å’Œé™çº§é€»è¾‘ã€‚

### å·²åˆ é™¤çš„æ–‡ä»¶
- âŒ `api/core/migration_manager.py` - è¿ç§»ç®¡ç†å™¨
- âŒ `api/scripts/run_migration.py` - æ‰‹åŠ¨è¿ç§»è„šæœ¬
- âŒ `config/datasources.json` - æ•°æ®åº“è¿æ¥é…ç½®æ–‡ä»¶
- âŒ `config/file-datasources.json` - æ–‡ä»¶æ•°æ®æºé…ç½®æ–‡ä»¶
- âŒ `config/datasources.json.backup` - å¤‡ä»½æ–‡ä»¶
- âŒ `config/file-datasources.json.backup` - å¤‡ä»½æ–‡ä»¶

### å·²ä¿®æ”¹çš„æ–‡ä»¶

#### 1. `api/main.py`
- âœ… ç§»é™¤å¯åŠ¨æ—¶çš„è‡ªåŠ¨è¿ç§»æ£€æŸ¥é€»è¾‘
- âœ… ç§»é™¤ `migration_manager` å¯¼å…¥
- âœ… ç®€åŒ–å¯åŠ¨æµç¨‹ï¼Œç›´æ¥ä» DuckDB åŠ è½½é…ç½®

#### 2. `api/core/database_manager.py`
- âœ… ç§»é™¤ `_load_connections_from_json()` æ–¹æ³•
- âœ… ç§»é™¤ JSON æ–‡ä»¶é™çº§é€»è¾‘
- âœ… ç®€åŒ– `_load_connections_from_config()` æ–¹æ³•ï¼Œåªä» DuckDB åŠ è½½

### æ¸…ç†åçš„æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ API Calls
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Backend API   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     DuckDB       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Metadata  â”‚  â”‚ â† å”¯ä¸€çš„æ•°æ®æº
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    Data    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¼˜åŠ¿
1. âœ… **ä»£ç æ›´ç®€æ´**ï¼šç§»é™¤äº†çº¦ 300 è¡Œè¿ç§»ç›¸å…³ä»£ç 
2. âœ… **ç»´æŠ¤æ›´å®¹æ˜“**ï¼šä¸å†éœ€è¦ç»´æŠ¤ JSON å’Œ DuckDB ä¸¤å¥—é€»è¾‘
3. âœ… **å¯åŠ¨æ›´å¿«**ï¼šä¸å†éœ€è¦æ£€æŸ¥å’Œæ‰§è¡Œè¿ç§»
4. âœ… **ä¸ä¼šç”Ÿæˆ backup æ–‡ä»¶**ï¼šå½»åº•è§£å†³äº† backup æ–‡ä»¶é—®é¢˜
5. âœ… **æ¶æ„æ›´æ¸…æ™°**ï¼šå•ä¸€æ•°æ®æºï¼Œæ²¡æœ‰é™çº§é€»è¾‘

### æ³¨æ„äº‹é¡¹
- âš ï¸ å¦‚æœéœ€è¦ä» JSON å¯¼å…¥é…ç½®ï¼Œéœ€è¦æ‰‹åŠ¨é€šè¿‡ API åˆ›å»ºè¿æ¥
- âš ï¸ ä¸å†æ”¯æŒä» JSON æ–‡ä»¶è‡ªåŠ¨è¿ç§»
- âœ… æ‰€æœ‰ç°æœ‰åŠŸèƒ½ä¿æŒä¸å˜ï¼Œåªæ˜¯ç§»é™¤äº†è¿ç§»ç›¸å…³ä»£ç 

---

**æ¸…ç†å®Œæˆï¼ç³»ç»Ÿç°åœ¨å®Œå…¨åŸºäº DuckDB å…ƒæ•°æ®ç®¡ç†ï¼Œä¸å†ä¾èµ– JSON æ–‡ä»¶ã€‚** ğŸ‰


## ğŸ§¹ ç¬¬äºŒè½®æ¸…ç†ï¼ˆ2024-12-04ï¼‰

### æ¸…ç† config_manager.py ä¸­çš„é—ç•™ä»£ç 

å‘ç° `config_manager.py` ä¸­è¿˜æœ‰å¤§é‡ä¸ JSON æ–‡ä»¶ç›¸å…³çš„ä»£ç ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆ `mysql-configs.json`ã€`datasources.json` å’Œ `file-datasources.json` æ–‡ä»¶ã€‚

#### å·²åˆ é™¤çš„æ–¹æ³•
- âŒ `load_mysql_configs()` - ä» JSON åŠ è½½ MySQL é…ç½®
- âŒ `load_datasources_config()` - ä» JSON åŠ è½½æ•°æ®æºé…ç½®
- âŒ `get_mysql_config()` - è·å– MySQL é…ç½®
- âŒ `get_all_mysql_configs()` - è·å–æ‰€æœ‰ MySQL é…ç½®
- âŒ `get_datasources_config()` - è·å–æ•°æ®æºé…ç½®
- âŒ `get_all_database_sources()` - è·å–æ‰€æœ‰æ•°æ®åº“æ•°æ®æº
- âŒ `_sync_database_manager_configs()` - åŒæ­¥æ•°æ®åº“ç®¡ç†å™¨é…ç½®
- âŒ `add_mysql_config()` - æ·»åŠ  MySQL é…ç½®
- âŒ `remove_mysql_config()` - åˆ é™¤ MySQL é…ç½®

#### å·²åˆ é™¤çš„å±æ€§
- âŒ `self.mysql_config_file` - mysql-configs.json è·¯å¾„
- âŒ `self.datasources_config_file` - datasources.json è·¯å¾„
- âŒ `self._mysql_configs` - MySQL é…ç½®ç¼“å­˜
- âŒ `self._datasources_config` - æ•°æ®æºé…ç½®ç¼“å­˜

#### å·²åˆ é™¤çš„åˆå§‹åŒ–ä»£ç 
- âŒ åˆ›å»ºé»˜è®¤ `mysql-configs.json` æ–‡ä»¶çš„ä»£ç 
- âŒ åˆ›å»ºé»˜è®¤ `datasources.json` æ–‡ä»¶çš„ä»£ç 

### æ¸…ç†æ•ˆæœ
- âœ… ä¸ä¼šå†è‡ªåŠ¨ç”Ÿæˆ `mysql-configs.json`
- âœ… ä¸ä¼šå†è‡ªåŠ¨ç”Ÿæˆ `datasources.json`
- âœ… ä¸ä¼šå†è‡ªåŠ¨ç”Ÿæˆ `file-datasources.json`
- âœ… ä¸ä¼šå†è‡ªåŠ¨ç”Ÿæˆä»»ä½• `.backup` æ–‡ä»¶
- âœ… `config_manager` åªç®¡ç† `app-config.json` å’Œ `sql-favorites.json`

### æœ€ç»ˆçš„ config ç›®å½•ç»“æ„
```
config/
â”œâ”€â”€ app-config.json           # åº”ç”¨é…ç½®ï¼ˆä¿ç•™ï¼‰
â”œâ”€â”€ app-config.example.json   # é…ç½®ç¤ºä¾‹ï¼ˆä¿ç•™ï¼‰
â”œâ”€â”€ sql-favorites.json        # SQL æ”¶è—ï¼ˆä¿ç•™ï¼‰
â””â”€â”€ secret.key                # åŠ å¯†å¯†é’¥ï¼ˆä¿ç•™ï¼‰
```

---

**ğŸ‰ å½»åº•æ¸…ç†å®Œæˆï¼ç³»ç»Ÿç°åœ¨å®Œå…¨åŸºäº DuckDB å…ƒæ•°æ®ç®¡ç†ï¼Œä¸å†æœ‰ä»»ä½• JSON è¿ç§»æˆ–é™çº§é€»è¾‘ã€‚**


## ğŸ§¹ ç¬¬ä¸‰è½®æ¸…ç†ï¼ˆ2024-12-04ï¼‰

### æ¸…ç† file_datasource_manager.py ä¸­çš„é—ç•™ä»£ç 

å‘ç° `file_datasource_manager.py` ä¸­è¿˜æœ‰åˆ›å»º `file-datasources.json` çš„ä»£ç ã€‚

#### å·²åˆ é™¤çš„ä»£ç 
- âŒ `__init__()` ä¸­åˆ›å»º `file-datasources.json` çš„ä»£ç 
- âŒ `self.config_file` å±æ€§å®šä¹‰
- âŒ `get_file_datasource()` ä¸­çš„ JSON é™çº§é€»è¾‘
- âŒ `list_file_datasources()` ä¸­çš„ JSON é™çº§é€»è¾‘å’Œè‡ªåŠ¨è¿ç§»ä»£ç 

#### ä¿®æ”¹åçš„æ–¹æ³•
- âœ… `get_file_datasource()` - åªä» DuckDB è¯»å–
- âœ… `list_file_datasources()` - åªä» DuckDB è¯»å–
- âœ… `__init__()` - ä¸å†åˆ›å»º JSON æ–‡ä»¶

### æœ€ç»ˆéªŒè¯
```bash
# åˆ é™¤æ‰€æœ‰ JSON æ–‡ä»¶
rm config/datasources.json config/file-datasources.json

# é‡å¯åº”ç”¨åï¼Œconfig ç›®å½•åªåŒ…å«ï¼š
config/
â”œâ”€â”€ app-config.json           # âœ… åº”ç”¨é…ç½®
â”œâ”€â”€ app-config.example.json   # âœ… é…ç½®ç¤ºä¾‹
â”œâ”€â”€ sql-favorites.json        # âœ… SQL æ”¶è—
â””â”€â”€ secret.key                # âœ… åŠ å¯†å¯†é’¥
```

---

**ğŸ‰ ä¸‰è½®æ¸…ç†å…¨éƒ¨å®Œæˆï¼ç³»ç»Ÿç°åœ¨å®Œå…¨ä¸ä¼šç”Ÿæˆä»»ä½• JSON é…ç½®æ–‡ä»¶æˆ– backup æ–‡ä»¶ï¼**

## ğŸ“Š æ¸…ç†æ€»ç»“

### åˆ é™¤çš„æ–‡ä»¶ï¼ˆ6ä¸ªï¼‰
1. âŒ `api/core/migration_manager.py` - è¿ç§»ç®¡ç†å™¨
2. âŒ `api/scripts/run_migration.py` - æ‰‹åŠ¨è¿ç§»è„šæœ¬
3. âŒ `config/datasources.json` - æ•°æ®åº“è¿æ¥é…ç½®
4. âŒ `config/file-datasources.json` - æ–‡ä»¶æ•°æ®æºé…ç½®
5. âŒ `config/datasources.json.backup` - å¤‡ä»½æ–‡ä»¶
6. âŒ `config/file-datasources.json.backup` - å¤‡ä»½æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆ4ä¸ªï¼‰
1. âœ… `api/main.py` - ç§»é™¤è‡ªåŠ¨è¿ç§»é€»è¾‘
2. âœ… `api/core/database_manager.py` - ç§»é™¤ JSON é™çº§é€»è¾‘
3. âœ… `api/core/config_manager.py` - ç§»é™¤ MySQL é…ç½®å’Œæ•°æ®æºé…ç½®ç›¸å…³ä»£ç 
4. âœ… `api/core/file_datasource_manager.py` - ç§»é™¤ JSON æ–‡ä»¶åˆ›å»ºå’Œé™çº§é€»è¾‘

### åˆ é™¤çš„ä»£ç é‡
- **æ€»è®¡çº¦ 600+ è¡Œä»£ç **
- migration_manager.py: ~300 è¡Œ
- config_manager.py: ~200 è¡Œ
- database_manager.py: ~60 è¡Œ
- file_datasource_manager.py: ~40 è¡Œ
- main.py: ~20 è¡Œ

### æœ€ç»ˆæ•ˆæœ
- âœ… ä¸ä¼šç”Ÿæˆä»»ä½• `.backup` æ–‡ä»¶
- âœ… ä¸ä¼šç”Ÿæˆ `mysql-configs.json`
- âœ… ä¸ä¼šç”Ÿæˆ `datasources.json`
- âœ… ä¸ä¼šç”Ÿæˆ `file-datasources.json`
- âœ… å®Œå…¨åŸºäº DuckDB å…ƒæ•°æ®ç®¡ç†
- âœ… ä»£ç æ›´ç®€æ´ã€æ›´æ˜“ç»´æŠ¤
- âœ… å¯åŠ¨æ›´å¿«ï¼ˆæ— è¿ç§»æ£€æŸ¥ï¼‰
- âœ… æ¶æ„æ›´æ¸…æ™°ï¼ˆå•ä¸€æ•°æ®æºï¼‰

---

**ğŸŠ æ­å–œï¼æ•°æ®æºå…ƒæ•°æ®è¿ç§»é¡¹ç›®å½»åº•å®Œæˆå¹¶æ¸…ç†å¹²å‡€ï¼**
