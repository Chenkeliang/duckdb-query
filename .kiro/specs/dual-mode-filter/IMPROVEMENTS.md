# åŒæ¨¡ç­›é€‰å™¨æ–‡æ¡£æ”¹è¿›æ€»ç»“

> **ç‰ˆæœ¬**: 1.1  
> **æ›´æ–°æ—¶é—´**: 2024-12-23  
> **æ”¹è¿›å†…å®¹**: è¡¥å……è¾¹ç•Œå¤„ç†ã€é”™è¯¯å¤„ç†ã€æµ‹è¯•ç­–ç•¥ã€æ— éšœç¢æ€§ã€æ€§èƒ½ä¼˜åŒ–ã€é›†æˆç»†èŠ‚

---

## ğŸ“Š æ”¹è¿›æ¦‚è§ˆ

| æ”¹è¿›é¡¹ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ | çŠ¶æ€ |
|--------|--------|--------|------|
| è¾¹ç•Œæƒ…å†µå¤„ç† | P0 | 0.5 å¤© | âœ… å·²è¡¥å…… |
| é”™è¯¯å¤„ç†è§„èŒƒ | P0 | 0.3 å¤© | âœ… å·²è¡¥å…… |
| æµ‹è¯•ç­–ç•¥ | P1 | 1 å¤© | âœ… å·²è¡¥å…… |
| æ€§èƒ½ä¼˜åŒ– | P2 | 0.3 å¤© | âœ… å·²è¡¥å…… |
| æ— éšœç¢æ€§ | P2 | 0.5 å¤© | âœ… å·²è¡¥å…… |
| å›½é™…åŒ–å®Œå–„ | P2 | 0.2 å¤© | âœ… å·²è¡¥å…… |
| é›†æˆç»†èŠ‚ | P1 | 0.3 å¤© | âœ… å·²è¡¥å…… |
| è¿ç§»å…¼å®¹ | P3 | 0.5 å¤© | âœ… å·²è¡¥å…… |

**æ€»è®¡**: 3.6 å¤©é¢å¤–å·¥ä½œé‡ï¼Œé¡¹ç›®æ€»å·¥æ—¶ä» 5 å¤©å¢åŠ åˆ° 6.5 å¤©

---

## ğŸ”§ è¯¦ç»†æ”¹è¿›å†…å®¹

### 1. è¾¹ç•Œæƒ…å†µå¤„ç†ï¼ˆrequirements.mdï¼‰

**æ–°å¢å†…å®¹**ï¼š

#### ç‰¹æ®Šå­—ç¬¦å¤„ç†è¡¨
- è¡¨å/åˆ—åå«ç©ºæ ¼ã€ä¸­æ–‡ã€å¼•å·çš„å¤„ç†è§„åˆ™
- å€¼å«å•å¼•å·çš„è½¬ä¹‰è§„åˆ™
- ç©ºå€¼ NULL ä¸ç©ºå­—ç¬¦ä¸²çš„åŒºåˆ†

#### æ•°æ®ç±»å‹æ ¡éªŒè¡¨
- INTEGER, BIGINT, DOUBLE, DECIMAL çš„æ ¡éªŒè§„åˆ™
- DATE, TIMESTAMP çš„æ ¼å¼è¦æ±‚
- BOOLEAN çš„å€¼çº¦æŸ

#### æ€§èƒ½çº¦æŸæ‰©å±•
- æ·»åŠ "è¶…å‡ºå¤„ç†"åˆ—ï¼Œæ˜ç¡®è¶…å‡ºé˜ˆå€¼çš„è¡Œä¸º
- æ–°å¢ SQL è§£æè¶…æ—¶ï¼ˆ100msï¼‰
- æ–°å¢æ¨¡å¼åˆ‡æ¢é˜²æŠ–ï¼ˆ300msï¼‰

**ä»£ç ç¤ºä¾‹**ï¼š
```typescript
function escapeSqlIdentifier(name: string): string {
  return `"${name.replace(/"/g, '""')}"`;
}

function escapeSqlString(value: string): string {
  return `'${value.replace(/'/g, "''")}'`;
}
```

---

### 2. é”™è¯¯å¤„ç†è§„èŒƒï¼ˆrequirements.mdï¼‰

**æ–°å¢å†…å®¹**ï¼š

#### é”™è¯¯ç±»å‹ä¸å¤„ç†è¡¨
- 7 ç§é”™è¯¯ç±»å‹çš„æ£€æµ‹æ—¶æœºã€å¤„ç†æ–¹å¼ã€ç”¨æˆ·æç¤º
- SQL æ³¨å…¥ã€è§£æå¤±è´¥ã€ç±»å‹ä¸åŒ¹é…ã€ç©ºæ¡ä»¶ç­‰

#### SQL æ³¨å…¥é˜²æŠ¤
- é˜²æŠ¤ç­–ç•¥è¯´æ˜
- è½¬ä¹‰å‡½æ•°å®ç°
- ç¦æ­¢ SQL å…³é”®å­—åœ¨å€¼ä¸­ä½¿ç”¨

**å…³é”®è§„åˆ™**ï¼š
- æ‰€æœ‰æ ‡è¯†ç¬¦ç”¨åŒå¼•å·åŒ…è£¹å¹¶è½¬ä¹‰
- æ‰€æœ‰å­—ç¬¦ä¸²å€¼ç”¨å•å¼•å·åŒ…è£¹å¹¶è½¬ä¹‰
- æ•°å€¼ç±»å‹ä¸¥æ ¼æ ¡éªŒ

---

### 3. æµ‹è¯•ç­–ç•¥ï¼ˆtasks.mdï¼‰

**æ–°å¢é˜¶æ®µ 7: æµ‹è¯•éªŒè¯ï¼ˆ1 å¤©ï¼‰**

#### å•å…ƒæµ‹è¯•è¡¥å……
- FilterChip æµ‹è¯•ï¼ˆæ¸²æŸ“ã€äº¤äº’ã€é”®ç›˜ã€ARIAï¼‰
- LogicConnector æµ‹è¯•ï¼ˆåˆ‡æ¢ã€é”®ç›˜ï¼‰
- GroupChip æµ‹è¯•ï¼ˆåµŒå¥—ã€é€’å½’ï¼‰

#### é›†æˆæµ‹è¯•
- FilterBar å®Œæ•´æµç¨‹æµ‹è¯•
- æ¨¡å¼åˆ‡æ¢å¾€è¿”æµ‹è¯•
- çŠ¶æ€åŒæ­¥æµ‹è¯•

#### E2E æµ‹è¯•
- å®Œæ•´ç”¨æˆ·æµç¨‹æµ‹è¯•
- 50+ æ¡ä»¶æ€§èƒ½æµ‹è¯•
- ç‰¹æ®Šå­—ç¬¦å¤„ç†æµ‹è¯•

#### æ— éšœç¢æ€§æµ‹è¯•
- é”®ç›˜å¯¼èˆªæµ‹è¯•
- å±å¹•é˜…è¯»å™¨æµ‹è¯•ï¼ˆNVDA/JAWSï¼‰
- ç„¦ç‚¹ç®¡ç†æµ‹è¯•

**æµ‹è¯•è¦†ç›–ç‡è¦æ±‚**: > 80%

---

### 4. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼ˆdesign.mdï¼‰

**æ–°å¢ç« èŠ‚: æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**

#### å¤§æ•°æ®é‡ä¼˜åŒ–è¡¨
| åœºæ™¯ | é˜ˆå€¼ | ä¼˜åŒ–æ–¹æ¡ˆ |
|------|------|---------|
| æ¡ä»¶æ•°é‡ | 50+ | react-window è™šæ‹Ÿæ»šåŠ¨ |
| æ‹–æ‹½æ“ä½œ | - | requestAnimationFrame |
| SQL è§£æ | 100ms | è¶…æ—¶é™çº§ |
| æ¨¡å¼åˆ‡æ¢ | - | é˜²æŠ– 300ms |

#### å®ç°ç¤ºä¾‹
- è™šæ‹Ÿæ»šåŠ¨ä»£ç ç¤ºä¾‹ï¼ˆä½¿ç”¨ react-windowï¼‰
- SQL è§£æè¶…æ—¶å¤„ç†ï¼ˆPromise + setTimeoutï¼‰
- æ¨¡å¼åˆ‡æ¢é˜²æŠ–ï¼ˆuseMemo + debounceï¼‰

---

### 5. æ— éšœç¢æ€§è§„èŒƒï¼ˆdesign.mdï¼‰

**æ–°å¢ç« èŠ‚: æ— éšœç¢æ€§è§„èŒƒ**

#### ARIA å±æ€§è¡¨
- 7 ç§å…ƒç´ çš„ role å’Œ aria-* å±æ€§è§„èŒƒ
- FilterChip, LogicConnector, FilterPopover ç­‰

#### é”®ç›˜æ“ä½œè¡¨
- æ¯ä¸ªå…ƒç´ æ”¯æŒçš„é”®ç›˜æ“ä½œ
- Enter, Delete, Tab, Arrow keys, Home, End ç­‰

#### ç„¦ç‚¹ç®¡ç†ä»£ç ç¤ºä¾‹
- Popover æ‰“å¼€æ—¶ç„¦ç‚¹ç§»åŠ¨
- Popover å…³é—­æ—¶ç„¦ç‚¹è¿”å›
- åˆ é™¤å…ƒç´ åç„¦ç‚¹å¤„ç†

**ç¬¦åˆæ ‡å‡†**: WCAG 2.1 AA çº§

---

### 6. å›½é™…åŒ–å®Œå–„ï¼ˆrequirements.mdï¼‰

**æ–°å¢ç« èŠ‚: å›½é™…åŒ– Key åˆ—è¡¨**

#### å®Œæ•´ i18n Keyï¼ˆ50+ ä¸ªï¼‰
- åŸºç¡€æ“ä½œï¼ˆæ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤ã€åˆ†ç»„ï¼‰
- æ¨¡å¼åˆ‡æ¢ï¼ˆå¯è§†åŒ–ã€SQLï¼‰
- é€»è¾‘è¿æ¥ç¬¦ï¼ˆANDã€ORï¼‰
- æ“ä½œç¬¦ï¼ˆ12 ç§æ“ä½œç¬¦çš„ä¸­è‹±æ–‡ï¼‰
- è¡¨å•å­—æ®µï¼ˆè¡¨ã€åˆ—ã€æ“ä½œç¬¦ã€å€¼ï¼‰
- é”™è¯¯æç¤ºï¼ˆ9 ç§é”™è¯¯çš„ä¸­è‹±æ–‡ï¼‰
- å ä½æç¤º
- æ“ä½œæŒ‰é’®

**ç¤ºä¾‹**ï¼š
```json
{
  "filter.operator.equals": "ç­‰äº / Equals (=)",
  "filter.error.invalidNumber": "è¯·è¾“å…¥æœ‰æ•ˆæ•°å­— / Please enter a valid number",
  "filter.emptyPlaceholder": "æš‚æ— ç­›é€‰æ¡ä»¶ï¼Œç‚¹å‡»åˆ—åæ—çš„å›¾æ ‡æ·»åŠ  / No filters yet, click column icon to add"
}
```

---

### 7. é›†æˆç»†èŠ‚ï¼ˆdesign.mdï¼‰

**æ–°å¢ç« èŠ‚: ä¸ JoinQueryPanel é›†æˆ**

#### çŠ¶æ€åŒæ­¥
- JoinQueryPanelState æ¥å£æ‰©å±•
- filterTree, filterMode, filterSqlOverride çŠ¶æ€åˆå§‹åŒ–

#### SQL ç”Ÿæˆé›†æˆ
- generateFinalSQL å‡½æ•°å®ç°
- WHERE å­å¥æ‹¼æ¥é€»è¾‘

#### å®æ—¶é¢„è§ˆåŒæ­¥
- ä½¿ç”¨ debounce 300ms é¿å…é¢‘ç¹æ›´æ–°
- useEffect ç›‘å¬ filterTree å˜åŒ–

#### å¯ç”¨åˆ—æ•°æ®ä¼ é€’
- ä» tables æå– availableColumns
- ä¼ é€’ç»™ FilterBar ç»„ä»¶

**ä»£ç å®Œæ•´æ€§**: æä¾›å®Œæ•´å¯è¿è¡Œçš„ä»£ç ç¤ºä¾‹

---

### 8. è¿ç§»ä¸å…¼å®¹ï¼ˆtasks.mdï¼‰

**æ–°å¢é˜¶æ®µ 8: è¿ç§»ä¸å…¼å®¹ï¼ˆ0.5 å¤©ï¼‰**

#### æ•°æ®è¿ç§»
- æ£€æŸ¥ç°æœ‰ JoinQuery æ•°æ®ç»“æ„
- å®ç° migrateOldFilters å‡½æ•°
- æµ‹è¯•è¿ç§»æ­£ç¡®æ€§

#### å‘åå…¼å®¹
- ä¿ç•™æ—§ APIï¼ˆå¦‚éœ€è¦ï¼‰
- æä¾›é€‚é…å™¨å‡½æ•°
- æ¸è¿›å¼å¯ç”¨ï¼ˆfeature flagï¼‰

**ç›®æ ‡**: ç¡®ä¿å¹³æ»‘è¿‡æ¸¡ï¼Œä¸ç ´åç°æœ‰åŠŸèƒ½

---

## ğŸ“ˆ æ–‡æ¡£è´¨é‡æå‡

### æ”¹è¿›å‰
- âŒ è¾¹ç•Œæƒ…å†µå¤„ç†ä¸å®Œæ•´
- âŒ é”™è¯¯å¤„ç†ä¸å¤Ÿè¯¦ç»†
- âŒ æµ‹è¯•ç­–ç•¥ç¼ºå¤±
- âŒ æ€§èƒ½ä¼˜åŒ–æœªæ˜ç¡®
- âŒ æ— éšœç¢æ€§æœªè€ƒè™‘
- âŒ å›½é™…åŒ–ä¸å®Œæ•´
- âŒ é›†æˆç»†èŠ‚ä¸è¶³
- âŒ è¿ç§»æ–¹æ¡ˆç¼ºå¤±

### æ”¹è¿›å
- âœ… å®Œæ•´çš„è¾¹ç•Œæƒ…å†µå¤„ç†è¡¨
- âœ… è¯¦ç»†çš„é”™è¯¯å¤„ç†è§„èŒƒ
- âœ… å®Œæ•´çš„æµ‹è¯•ç­–ç•¥ï¼ˆå•å…ƒ/é›†æˆ/E2Eï¼‰
- âœ… æ˜ç¡®çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ
- âœ… å®Œæ•´çš„æ— éšœç¢æ€§è§„èŒƒï¼ˆWCAG 2.1 AAï¼‰
- âœ… 50+ ä¸ª i18n Key
- âœ… å®Œæ•´çš„é›†æˆä»£ç ç¤ºä¾‹
- âœ… æ•°æ®è¿ç§»ä¸å…¼å®¹æ–¹æ¡ˆ

---

## âœ… éªŒæ”¶æ ‡å‡†æå‡

### æ”¹è¿›å‰ï¼ˆ3 ç±»ï¼Œ10 é¡¹ï¼‰
- åŠŸèƒ½éªŒæ”¶ï¼ˆ6 é¡¹ï¼‰
- å…¼å®¹æ€§éªŒæ”¶ï¼ˆ3 é¡¹ï¼‰
- æ€§èƒ½éªŒæ”¶ï¼ˆ2 é¡¹ï¼‰

### æ”¹è¿›åï¼ˆ7 ç±»ï¼Œ35 é¡¹ï¼‰
- åŠŸèƒ½éªŒæ”¶ï¼ˆ8 é¡¹ï¼‰
- ä»£ç è´¨é‡ï¼ˆ5 é¡¹ï¼‰
- å…¼å®¹æ€§ï¼ˆ4 é¡¹ï¼‰
- æ€§èƒ½ï¼ˆ4 é¡¹ï¼‰
- æ— éšœç¢æ€§ï¼ˆ4 é¡¹ï¼‰
- é”™è¯¯å¤„ç†ï¼ˆ4 é¡¹ï¼‰
- å›½é™…åŒ–ï¼ˆ3 é¡¹ï¼‰

**æå‡**: éªŒæ”¶é¡¹ä» 10 é¡¹å¢åŠ åˆ° 35 é¡¹ï¼Œè¦†ç›–æ›´å…¨é¢

---

## ğŸ¯ å®æ–½å»ºè®®

### ä¼˜å…ˆçº§é¡ºåº
1. **P0 - è¾¹ç•Œå¤„ç†ä¸å®‰å…¨**ï¼ˆDay 1ï¼‰
   - å®ç°è½¬ä¹‰å‡½æ•°
   - å®ç°ç±»å‹æ ¡éªŒ
   - ç¼–å†™å•å…ƒæµ‹è¯•

2. **P1 - æ ¸å¿ƒåŠŸèƒ½**ï¼ˆDay 2-4ï¼‰
   - æŒ‰åŸè®¡åˆ’å®æ–½
   - é›†æˆè¾¹ç•Œå¤„ç†

3. **P2 - æµ‹è¯•ä¸ä¼˜åŒ–**ï¼ˆDay 5ï¼‰
   - å®Œæˆæ‰€æœ‰æµ‹è¯•
   - æ€§èƒ½ä¼˜åŒ–
   - æ— éšœç¢æ€§å®ç°

4. **P3 - æ¶¦è‰²ä¸è¿ç§»**ï¼ˆDay 6-6.5ï¼‰
   - å›½é™…åŒ–å®Œå–„
   - æ•°æ®è¿ç§»
   - æœ€ç»ˆéªŒæ”¶

### é£é™©æ§åˆ¶
- **è¾¹ç•Œå¤„ç†å¿…é¡»ä¼˜å…ˆ**ï¼šé¿å…åæœŸè¿”å·¥
- **æµ‹è¯•è¦†ç›–ç‡ > 80%**ï¼šä¿è¯è´¨é‡
- **æ— éšœç¢æ€§ä¸å¯å¿½ç•¥**ï¼šç¬¦åˆæ ‡å‡†
- **æ€§èƒ½ä¼˜åŒ–é¢„ç•™æ—¶é—´**ï¼šé¿å…å¡é¡¿

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [requirements.md](.kiro/specs/dual-mode-filter/requirements.md) - éœ€æ±‚æ–‡æ¡£ï¼ˆå·²æ›´æ–°ï¼‰
- [design.md](.kiro/specs/dual-mode-filter/design.md) - è®¾è®¡æ–‡æ¡£ï¼ˆå·²æ›´æ–°ï¼‰
- [tasks.md](.kiro/specs/dual-mode-filter/tasks.md) - ä»»åŠ¡æ¸…å•ï¼ˆå·²æ›´æ–°ï¼‰

---

**æ”¹è¿›å®Œæˆæ—¶é—´**: 2024-12-23  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.1  
**çŠ¶æ€**: âœ… å·²å®Œæˆæ‰€æœ‰è¡¥å……
