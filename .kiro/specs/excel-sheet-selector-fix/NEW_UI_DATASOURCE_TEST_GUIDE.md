# 新 UI 数据源管理页面测试指南

## 🎯 测试目标

测试新 UI 的数据源管理页面的所有功能，确保：
1. 所有组件正常工作
2. Toast 通知正确显示
3. 数据刷新机制正常
4. 用户体验流畅

---

## 📋 测试前准备

### 1. 启动开发环境

```bash
# 启动后端
cd api
python -m uvicorn main:app --reload

# 启动前端（新终端）
cd frontend
npm run dev
```

### 2. 访问新 UI
- 打开浏览器访问：`http://localhost:5173`
- 确保使用的是新 UI（DuckQueryApp）而不是旧 UI（ShadcnApp）

---

## 🧪 测试场景

### 场景 1: 文件上传功能

#### 1.1 CSV 文件上传
**步骤**:
1. 点击"数据源"标签
2. 确保在"文件上传"子标签
3. 点击"选择文件"或拖拽 CSV 文件
4. 选择一个 CSV 文件
5. 输入表名（或使用默认名称）
6. 点击"上传"

**预期结果**:
- ✅ 文件选择后显示文件名和大小
- ✅ 上传过程中显示进度条
- ✅ 上传成功后显示绿色 Toast："文件上传成功"
- ✅ 数据源列表自动刷新
- ✅ 新表出现在数据源列表中

**检查点**:
- [ ] Toast 通知是否显示？
- [ ] Toast 通知颜色是否正确（绿色）？
- [ ] 数据源列表是否自动刷新？
- [ ] 新表是否出现在列表中？

#### 1.2 Excel 文件上传
**步骤**:
1. 选择一个 Excel 文件（.xlsx）
2. 如果有多个 Sheet，应该弹出 Sheet 选择器
3. 选择要导入的 Sheet
4. 输入表名
5. 点击"上传"

**预期结果**:
- ✅ Excel 文件选择后显示 Sheet 选择器
- ✅ Sheet 选择器显示所有可用的 Sheet
- ✅ 可以预览 Sheet 数据
- ✅ 上传成功后显示 Toast
- ✅ 数据源列表自动刷新

**检查点**:
- [ ] Sheet 选择器是否正确显示？
- [ ] 可以预览 Sheet 数据吗？
- [ ] Toast 通知是否显示？
- [ ] 数据源列表是否刷新？

#### 1.3 上传错误处理
**步骤**:
1. 尝试上传一个非常大的文件（> 100MB）
2. 尝试上传一个格式错误的文件
3. 尝试上传到已存在的表名

**预期结果**:
- ✅ 文件过大时显示错误 Toast
- ✅ 格式错误时显示错误 Toast
- ✅ 表名冲突时显示错误 Toast
- ✅ 错误 Toast 是红色的
- ✅ 错误消息包含详细信息

**检查点**:
- [ ] 错误 Toast 是否显示？
- [ ] 错误消息是否清晰？
- [ ] 错误 Toast 颜色是否正确（红色）？

---

### 场景 2: 数据粘贴功能

#### 2.1 CSV 数据粘贴
**步骤**:
1. 点击"数据粘贴板"标签
2. 粘贴以下 CSV 数据：
```csv
name,age,city
Alice,25,New York
Bob,30,London
Charlie,35,Tokyo
```
3. 点击"解析数据"
4. 检查预览表格
5. 输入表名：`test_paste_csv`
6. 点击"保存到数据库"

**预期结果**:
- ✅ 解析成功后显示绿色 Toast："解析成功：3 行 3 列"
- ✅ 预览表格显示正确的数据
- ✅ 列名和类型自动检测
- ✅ 保存成功后显示绿色 Toast："数据已保存到表 test_paste_csv"
- ✅ 数据源列表自动刷新
- ✅ 表单自动清空

**检查点**:
- [ ] 解析成功 Toast 是否显示？
- [ ] 预览表格是否正确？
- [ ] 列类型是否正确检测？
- [ ] 保存成功 Toast 是否显示？
- [ ] 数据源列表是否刷新？
- [ ] 表单是否清空？

#### 2.2 JSON 数据粘贴
**步骤**:
1. 选择格式为 "JSON"
2. 粘贴以下 JSON 数据：
```json
[
  {"name": "Alice", "age": 25, "city": "New York"},
  {"name": "Bob", "age": 30, "city": "London"},
  {"name": "Charlie", "age": 35, "city": "Tokyo"}
]
```
3. 点击"解析数据"
4. 输入表名：`test_paste_json`
5. 点击"保存到数据库"

**预期结果**:
- ✅ JSON 解析成功
- ✅ 显示解析成功 Toast
- ✅ 预览表格显示正确
- ✅ 保存成功后显示 Toast
- ✅ 数据源列表刷新

**检查点**:
- [ ] JSON 解析是否成功？
- [ ] Toast 通知是否显示？
- [ ] 数据是否正确保存？

#### 2.3 粘贴错误处理
**步骤**:
1. 粘贴格式错误的数据
2. 点击"解析数据"
3. 不输入表名直接点击"保存"
4. 输入已存在的表名并保存

**预期结果**:
- ✅ 格式错误时显示错误 Toast："解析失败：{错误详情}"
- ✅ 表名为空时显示警告 Toast
- ✅ 表名冲突时显示错误 Toast
- ✅ 所有错误消息都清晰明确

**检查点**:
- [ ] 错误 Toast 是否显示？
- [ ] 错误消息是否有帮助？
- [ ] Toast 颜色是否正确？

---

### 场景 3: 数据库连接管理

#### 3.1 添加新连接
**步骤**:
1. 点击"数据库管理"标签
2. 选择数据库类型（如 PostgreSQL）
3. 填写连接信息：
   - 主机：localhost
   - 端口：5432
   - 数据库：testdb
   - 用户名：testuser
   - 密码：testpass
4. 点击"测试连接"
5. 如果测试成功，点击"保存连接"

**预期结果**:
- ✅ 测试连接成功显示绿色 Toast
- ✅ 保存连接成功显示绿色 Toast
- ✅ 连接出现在已保存连接列表中
- ✅ 可以看到连接状态指示器

**检查点**:
- [ ] 测试连接 Toast 是否显示？
- [ ] 保存连接 Toast 是否显示？
- [ ] 连接是否出现在列表中？
- [ ] 状态指示器是否正确？

#### 3.2 编辑连接
**步骤**:
1. 在已保存连接列表中找到一个连接
2. 点击"编辑"按钮
3. 修改连接信息
4. 点击"保存"

**预期结果**:
- ✅ 编辑表单预填充现有信息
- ✅ 保存成功显示 Toast
- ✅ 连接列表自动更新

**检查点**:
- [ ] 编辑表单是否正确预填充？
- [ ] 保存 Toast 是否显示？
- [ ] 列表是否更新？

#### 3.3 删除连接
**步骤**:
1. 点击连接的"删除"按钮
2. 确认删除

**预期结果**:
- ✅ 显示确认对话框
- ✅ 删除成功显示 Toast
- ✅ 连接从列表中移除

**检查点**:
- [ ] 确认对话框是否显示？
- [ ] 删除 Toast 是否显示？
- [ ] 连接是否从列表移除？

---

### 场景 4: 数据源列表刷新

#### 4.1 自动刷新
**步骤**:
1. 上传一个文件
2. 观察数据源列表

**预期结果**:
- ✅ 上传完成后列表自动刷新
- ✅ 新数据源立即出现
- ✅ 不需要手动刷新页面

**检查点**:
- [ ] 列表是否自动刷新？
- [ ] 新数据源是否立即显示？

#### 4.2 手动刷新
**步骤**:
1. 点击数据源列表的刷新按钮

**预期结果**:
- ✅ 列表立即刷新
- ✅ 显示最新的数据源

**检查点**:
- [ ] 刷新按钮是否工作？
- [ ] 列表是否更新？

---

### 场景 5: Toast 通知系统

#### 5.1 Toast 显示位置
**检查点**:
- [ ] Toast 是否在屏幕右上角显示？
- [ ] Toast 是否不遮挡重要内容？
- [ ] 多个 Toast 是否正确堆叠？

#### 5.2 Toast 颜色
**检查点**:
- [ ] 成功 Toast 是绿色的吗？
- [ ] 错误 Toast 是红色的吗？
- [ ] 警告 Toast 是橙色的吗？
- [ ] 信息 Toast 是蓝色的吗？

#### 5.3 Toast 自动消失
**检查点**:
- [ ] Toast 是否在 3-5 秒后自动消失？
- [ ] 可以手动关闭 Toast 吗？
- [ ] 关闭动画是否流畅？

---

## 🐛 已知问题检查

### 1. Excel Sheet 选择器
- [ ] Sheet 选择器是否正确显示？
- [ ] 可以预览每个 Sheet 吗？
- [ ] 选择 Sheet 后是否正确导入？

### 2. 数据粘贴板
- [ ] 所有操作都有 Toast 通知吗？
- [ ] 解析成功/失败都有反馈吗？
- [ ] 保存成功/失败都有反馈吗？

### 3. 文件上传
- [ ] 上传进度是否显示？
- [ ] 上传成功后是否有 Toast？
- [ ] 数据源列表是否自动刷新？

---

## 📊 测试结果记录

### 测试环境
- **日期**: ___________
- **测试人**: ___________
- **浏览器**: ___________
- **操作系统**: ___________

### 测试结果汇总

| 场景 | 通过 | 失败 | 备注 |
|------|------|------|------|
| 文件上传 - CSV | ☐ | ☐ | |
| 文件上传 - Excel | ☐ | ☐ | |
| 文件上传 - 错误处理 | ☐ | ☐ | |
| 数据粘贴 - CSV | ☐ | ☐ | |
| 数据粘贴 - JSON | ☐ | ☐ | |
| 数据粘贴 - 错误处理 | ☐ | ☐ | |
| 数据库连接 - 添加 | ☐ | ☐ | |
| 数据库连接 - 编辑 | ☐ | ☐ | |
| 数据库连接 - 删除 | ☐ | ☐ | |
| 数据源列表刷新 | ☐ | ☐ | |
| Toast 通知系统 | ☐ | ☐ | |

### 发现的问题

1. **问题描述**: ___________
   - **严重程度**: ☐ 高 ☐ 中 ☐ 低
   - **重现步骤**: ___________
   - **预期结果**: ___________
   - **实际结果**: ___________

2. **问题描述**: ___________
   - **严重程度**: ☐ 高 ☐ 中 ☐ 低
   - **重现步骤**: ___________
   - **预期结果**: ___________
   - **实际结果**: ___________

---

## 🎯 测试通过标准

### 必须通过的测试
- ✅ 所有文件上传功能正常
- ✅ 所有数据粘贴功能正常
- ✅ 所有 Toast 通知正确显示
- ✅ 数据源列表自动刷新
- ✅ 错误处理正确

### 可选通过的测试
- ✅ 数据库连接管理（如果有数据库）
- ✅ 性能测试（大文件上传）
- ✅ 边界测试（极端情况）

---

## 📝 测试建议

### 测试顺序
1. 先测试基本功能（文件上传、数据粘贴）
2. 再测试 Toast 通知系统
3. 最后测试错误处理和边界情况

### 测试技巧
- 打开浏览器开发者工具的 Console 查看错误
- 打开 Network 标签查看 API 请求
- 使用不同大小和格式的测试文件
- 测试快速连续操作（如快速点击上传）

### 常见问题排查
- **Toast 不显示**: 检查 `showNotification` 是否正确传递
- **列表不刷新**: 检查 `triggerRefresh` 是否被调用
- **上传失败**: 检查后端 API 是否正常运行
- **样式问题**: 检查 Tailwind CSS 是否正确加载

---

## 🎉 测试完成

测试完成后，请：
1. 填写测试结果汇总表
2. 记录所有发现的问题
3. 将测试报告提交给开发团队
4. 如果所有测试通过，可以准备发布新 UI

**祝测试顺利！** 🚀
